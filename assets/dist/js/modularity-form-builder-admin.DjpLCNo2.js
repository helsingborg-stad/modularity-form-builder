var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});($=>{function Conditional(){$(document).ready((function(){this.populateSelectFields(),this.handleEvents(),this.handleAcfConditionals()}).bind(this))}return __name(Conditional,"Conditional"),Conditional.prototype.handleAcfConditionals=()=>{typeof acf<"u"&&document.querySelectorAll('.acf-field[data-name="form_fields"]').forEach(form=>{const conditionalFields=document.querySelectorAll('[data-name="conditonal_field"]');console.log(conditionalFields),conditionalFields&&Conditional.prototype.handleSelectedConditionalFields(conditionalFields)})},Conditional.prototype.handleSelectedConditionalFields=conditionalFields=>{conditionalFields.forEach(field=>{const selectField=field.querySelector("select"),hiddenField=field.querySelector('input[type="hidden"]');hiddenField&&hiddenField.value&&(selectField.value=hiddenField.value)})},Conditional.prototype.populateSelectFields=function(){$('[data-name="conditonal_field"] select').each((function(index,element){var selected="",$selected=$(":selected",element);if($selected.val())selected=$selected.val();else if(typeof modularity_current_post_id<"u"){var fieldName=$(element).attr("name");$.ajax({url:ajaxurl,type:"post",data:{action:"get_selected_field",moduleId:modularity_current_post_id,fieldName},success:__name(response=>{response!="error"&&$("option[value='"+response+"']",element).prop("selected",!0)},"success")})}$("optgroup, option",element).remove();var options=this.getOptions();typeof options<"u"&&options.length>0?($(".condition-missing").remove(),$.each(options,(function(key,value){var selectvalues="";$.each(value.selectvalues,(function(key2,option){var groubLabel=this.conditionalString(value.groupLabel),optionValue=this.conditionalString(option),optionObj={label:groubLabel,value:optionValue};selectvalues+="<option value='"+JSON.stringify(optionObj)+"'>"+option+"</option>"}).bind(this));var optgroup='<optgroup label="'+value.groupLabel+'">'+selectvalues+"</optgroup>";$(element).append(optgroup),selected&&$("option[value='"+selected+"']",element).prop("selected",!0)}).bind(this))):($(".condition-missing").remove(),$('<p class="condition-missing">'+formbuilder.selections_missing+"</p>").insertBefore(element))}).bind(this))},Conditional.prototype.getOptions=argument=>{var selectOptions=[];return $('[data-layout="radio"]:not(.acf-clone)').each((index,item)=>{var $item=$(item),value=$item.find('[data-name="label"] input').val(),optionGroup={groupLabel:value,selectvalues:[]};$('[data-key="field_58eb670d39fef"] table tbody',item).children("tr.acf-row:not(.acf-clone)").each((index2,item2)=>{var $item2=$(item2),value2=$item2.find('[data-name="value"] input').val();optionGroup.selectvalues.push(value2)}),selectOptions.push(optionGroup)}),selectOptions},Conditional.prototype.conditionalString=string=>(string=string.toLowerCase(),string=string.replace(/\s+/g,"_"),string=string.replace(/[^a-z0-9_]+/gi,""),string=string.replace(/_+$/,""),string),Conditional.prototype.handleEvents=function(){$(document).on("click",'[data-name="conditional_logic"] [type="checkbox"], [data-layout="radio"] .acf-row-handle > a',(function(){this.populateSelectFields()}).bind(this))},new Conditional})(jQuery);($=>{var selectionsArray=[];function Notification(){$((function(){this.init(),this.dataGathering(),this.updateMainSelect(),this.updateSubSelect(),$(document).on("click",'.post-type-mod-form input[type="checkbox"], .post-type-mod-form .acf-tab-button',(function(event){this.dataGathering(),this.updateMainSelect(),this.updateSubSelect()}).bind(this)),$("[data-name='form_conditional_field'] .acf-input select").change((function(event){this.updateSubSelect()}).bind(this))}).bind(this))}return __name(Notification,"Notification"),Notification.prototype.init=()=>{typeof notificationConditions<"u"&&notificationConditions!==null&&(notificationConditions=JSON.parse(notificationConditions),["conditional_field","conditional_field_equals"].forEach(fieldType=>{$("[data-name='notify'] .acf-row:not(.acf-clone)").each((row_index,row)=>{if(notificationConditions[row_index]!==null){var currentSelect=$("[data-name='form_"+fieldType+"'] .acf-input select",row);currentSelect.empty(),currentSelect.append($("<option></option>").attr("value",notificationConditions[row_index][fieldType]).text(notificationConditions[row_index][fieldType]).attr("selected","selected"))}})}))},Notification.prototype.updateMainSelect=function(){$("[data-name='notify'] .acf-row:not(.acf-clone)").each(((row_index,row)=>{var conditionalField=$("[data-name='form_conditional_field'] .acf-input select",row),previousValue=$(conditionalField).val();$(conditionalField).empty(),$.each(selectionsArray,(value_index,value)=>{previousValue==value_index?$(conditionalField).append($("<option></option>").attr("value",value_index).text(value_index).attr("selected","selected")):$(conditionalField).append($("<option></option>").attr("value",value_index).text(value_index))})}).bind(this))},Notification.prototype.updateSubSelect=function(){$("[data-name='notify'] .acf-row:not(.acf-clone)").each(((row_index,row)=>{var conditionalFieldEquals=$("[data-name='form_conditional_field_equals'] .acf-input select",row),conditionalField=$("[data-name='form_conditional_field'] .acf-input select",row),previousValueEquals=$(conditionalFieldEquals).val();$(conditionalField).val(),$(conditionalFieldEquals).empty(),$.each(selectionsArray,(value_index,value)=>{conditionalField.val()==value_index&&$.each(selectionsArray[value_index],(i,v)=>{previousValueEquals==v?$(conditionalFieldEquals).append($("<option></option>").attr("value",v).text(v).attr("selected","selected")):$(conditionalFieldEquals).append($("<option></option>").attr("value",v).text(v))})})}).bind(this))},Notification.prototype.dataGathering=()=>{selectionsArray={},$("[data-name='form_fields'] .layout").each(function(layout_index,layout){var currentLayout=$(layout).attr("data-layout"),currentNameKey=$(".acf-fields  [data-name='label'] .acf-input .acf-input-wrap input",layout).val();if(["select","radio"].indexOf(currentLayout)!=-1){var isRequired=$("[data-name='required'] .acf-input label input",layout).prop("checked"),hasCondition=$("[data-name='conditional_logic'] .acf-input label input",layout).prop("checked");if(isRequired&&!hasCondition){selectionsArray[currentNameKey]=[];var dataField=$("[data-name='values'] tbody [data-name='value'] .acf-input .acf-input-wrap input[type='text']",layout);$(dataField).filter((item_key,item_value)=>!$(item_value).attr("name").includes("acfclonefield")).each(((data_index,data_value)=>{$(data_value).val()&&currentNameKey&&selectionsArray[currentNameKey].push($(data_value).val())}).bind(this))}}})},new Notification})(jQuery);($=>{function EditForm(){$((function(){this.handleEvents()}).bind(this))}return __name(EditForm,"EditForm"),EditForm.prototype.deleteFile=(postId,formId,filePath,fieldName,target)=>{$.ajax({url:ajaxurl,type:"post",data:{action:"delete_file",postId,formId,filePath,fieldName},beforeSend:__name(response=>{target.remove()},"beforeSend"),error:__name((jqXHR,textStatus,errorThrown)=>{console.log("Error: "+textStatus)},"error")})},EditForm.prototype.uploadFile=(files,postId,formId,fieldName,target)=>{var data=new FormData;data.append("action","upload_files"),data.append("postId",postId),data.append("formId",formId),data.append("fieldName",fieldName),$.each(files,(key,value)=>{data.append(fieldName+"[]",value)}),$.ajax({url:ajaxurl,type:"POST",data,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:__name(response=>{$("input[type=file]",target).hide(),$(".upload-status",target).html('<div class="spinner spinner-dark is-active" style="float:none;"></div>')},"beforeSend"),success:__name((response,textStatus,jqXHR)=>{response.success&&$(":submit","#publishing-action,#edit-post").trigger("click"),$(".upload-status",target).html("<p>"+response.data+"</p>"),$("input[type=file]",target).show()},"success"),error:__name((jqXHR,textStatus)=>{console.log("error: "+textStatus),$("input[type=file]",target).show(),$(".upload-status",target).hide()},"error")})},EditForm.prototype.savePost=event=>{var $form=$(event.target),data=new FormData(event.target);return data.append("action","save_post"),$form.find('button[type="submit"]').attr("disabled","true").append('<span class="spinner"></span>'),$.ajax({url:ajaxurl,type:"POST",data,dataType:"json",processData:!1,contentType:!1,success:__name(response=>{response.success?$form.find('button[type="submit"]').append('<i class="pricon pricon-check"></i>').find(".spinner").hide():$(".modal-footer",$form).html('<span class="notice warning"><i class="pricon pricon-notice-warning"></i> '+response.data+"</span>")},"success"),complete:__name(()=>{location.hash="",location.reload()},"complete")}),!1},EditForm.prototype.handleEvents=function(){$(document).on("submit","#edit-post",(function(e){e.preventDefault(),this.savePost(e)}).bind(this)),$(document).on("click",".delete-form-file",(function(e){if(e.preventDefault(),window.confirm(formbuilder.delete_confirm)){var postId=$(e.target).attr("postid"),formId=$(e.target).attr("formid"),filePath=$(e.target).attr("filepath"),fieldName=$(e.target).attr("fieldname"),$target=$(e.target).parents("span");this.deleteFile(postId,formId,filePath,fieldName,$target)}}).bind(this)),$(document).on("change","input[type=file]",(function(e){var files=e.target.files,postId=$(e.target).attr("postid"),formId=$(e.target).attr("formid"),fieldName=$(e.target).attr("fieldname"),$target=$(e.target).parents(".mod-form-field");this.uploadFile(files,postId,formId,fieldName,$target)}).bind(this))},new EditForm})(jQuery);($=>{function externalUpload(){$((()=>{formbuilder.mod_form_authorized||$('[data-name="upload_videos_external"]').hide()}).bind(this))}return __name(externalUpload,"externalUpload"),new externalUpload})(jQuery);
//# sourceMappingURL=modularity-form-builder-admin.DjpLCNo2.js.map
